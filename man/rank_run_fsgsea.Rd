% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rank_run_fgsea.R
\name{rank_run_fsgsea}
\alias{rank_run_fsgsea}
\title{Run Ranked Gene Set Enrichment Analysis (fGSEA) from limma Results}
\usage{
rank_run_fsgsea(
  limma_results_df,
  msigdb_collection,
  msigdb_cached = NULL,
  fgsea_maxsize = 500,
  fgsea_minsize = 15,
  top_pathways = 10,
  rank_by = "logFC+P.Value",
  gene_name_colname = "Gene Name",
  plot_enrichment = TRUE,
  comparison_name = NULL
)
}
\arguments{
\item{limma_results_df}{A data frame containing differential expression results,
typically from a \code{limma::topTable()} output. Must include columns for
\code{logFC}, \code{P.Value}, and a gene identifier column.}

\item{msigdb_collection}{Character vector specifying one or more MSigDB collection codes
(e.g., \code{"H"} for hallmark, \code{"C2"} for curated gene sets).
Valid options are retrieved via \code{msigdbr::msigdbr_collections()}.}

\item{msigdb_cached}{Optional pre-fetched MSigDB data frame (to avoid repeated API calls).
If supplied, must contain at least columns \code{gs_name}, \code{gene_symbol},
\code{gs_cat}, \code{gs_subcat}, and \code{gs_description}.}

\item{fgsea_maxsize}{Integer; maximum size of gene sets to include in analysis (default: \code{500}).}

\item{fgsea_minsize}{Integer; minimum size of gene sets to include in analysis (default: \code{15}).}

\item{top_pathways}{Integer; number of top enriched pathways to display in the summary plot (default: \code{10}).}

\item{rank_by}{Character string specifying how genes are ranked. Options are:
\itemize{
\item \code{"logFC"} — rank by log fold change.
\item \code{"P.Value"} — rank by \eqn{-log10(P.Value)}.
\item \code{"logFC+P.Value"} — combined ranking using \eqn{-log10(P.Value) * sign(logFC)} (default).
}}

\item{gene_name_colname}{Character string indicating the column name in \code{limma_results_df}
corresponding to gene symbols (default: \code{"Gene Name"}).}

\item{plot_enrichment}{Logical; if \code{TRUE}, generates both the enrichment plot for the top pathway
and a summary plot for the top enriched pathways (default: \code{TRUE}).}

\item{comparison_name}{Optional character string used in plot titles to label the comparison
(e.g., "Cluster 1 vs Control").}
}
\value{
A named list containing:
\itemize{
\item \code{ranked_df} — Data frame of ranked genes with scores used for enrichment.
\item \code{ranked_genes} — Named numeric vector of ranked gene scores (input to fgsea).
\item \code{gene_set_metadata} — Data frame describing the gene sets used (name, category, subcategory, description).
\item \code{fgsea_results} — Data frame of enrichment results from \code{fgseaMultilevel()}, including NES, p-values, and adjusted p-values.
\item \code{fgsea_plot} — (Optional) \code{ggplot2} object showing enrichment for the top pathway.
\item \code{top_pathways_plot} — (Optional) \code{ggplot2} object summarizing the top enriched pathways.
}
}
\description{
This function performs a ranked Gene Set Enrichment Analysis (GSEA) using \pkg{fgsea}
based on differential expression results (e.g., from \pkg{limma}).
Genes are ranked according to log fold change, p-value, or a combined score,
and enrichment is tested against user-specified MSigDB gene set collections.
Optionally, enrichment plots and summary visualizations of the top enriched pathways are produced.
}
\details{
The function first validates the chosen MSigDB collections and retrieves or filters the corresponding gene sets.
Genes are ranked according to the selected \code{rank_by} method, and only unique gene entries
(highest absolute score per gene) are retained.
The ranked gene vector is then used as input to \code{fgseaMultilevel()} to compute enrichment scores (NES)
and adjusted p-values.

Two plots can be optionally generated:
\enumerate{
\item An enrichment curve for the top pathway.
\item A bubble plot summarizing the top enriched pathways, where bubble color represents adjusted p-value,
size represents gene set size, and shape indicates significance.
}
}
\examples{
\dontrun{
# Example using limma differential expression results
gsea_results <- rank_run_fsgsea(
  limma_results_df = limma_res,
  msigdb_collection = c("H", "C2"),
  rank_by = "logFC+P.Value",
  comparison_name = "Cluster 1 vs Control"
)

# View results and plots
head(gsea_results$fgsea_results)
gsea_results$top_pathways_plot
}

}
\seealso{
\code{\link[fgsea:fgseaMultilevel]{fgsea::fgseaMultilevel()}}, \code{\link[msigdbr:msigdbr]{msigdbr::msigdbr()}}, \code{\link[limma:toptable]{limma::topTable()}}
}
